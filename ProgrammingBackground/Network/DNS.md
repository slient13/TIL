#network 

# 개요 
[[DNS]] 즉 ==domain name system==은 [[domain name]]을 [[ip 주소]]로 상호 변환시켜주는 시스템이다.

# DNS server
[[domain name]]과 그에 대응되는 [[ip 주소]]를 연결시켜주는 서버로 수많은 [[ip 주소]]와 그것에 대응되는[[domain name]]을 저장하고 있다.

일반적으로 인터넷을 이용할 때는 [[domain name]]을 이용하는데, 브라우저에 그러한 문자열을 입력하면 그 내용은 사전에 지정한(혹은 자동으로 지정된) [[#DNS server]]에 전송되고 [[#DNS server]]는 대응되는 [[ip 주소]]를 요청지로 반환해준다. 사용자의 컴퓨터는 이렇게 반환받은 [[ip 주소]]를 이용해 원하는 목적지로 접속을 시도할 수 있다. 위와 같은 과정은 사용자가 알아채지 못하게 자동으로 수행된다.

## hosts file
[[domain name]]과 그것에 대응되는 [[ip 주소]]를 기록해둔 파일이다. 웹 브라우저 등 [[domain name]]을 통해 다른 기기에 접속하는 프로그램들은 우선적으로 해당 파일의 기록을 참고해 목적지를 파악한다. 만약 대응하는 파일이 존재하지 않는다면 [[#DNS server]]에 요청하여 대응하는 [[ip 주소]]를 내려받는다.(내려 받은 도메인 정보를 저장하진 않는다.)

운영체제마다 경로는 다르지만 하나씩 관련 파일을 가지고 있으며 그 중 windows 10은 `%SystemRoot%/System32/drivers/etc/hosts`에 위치하고 있다. 공격자에 의해 해당 내용이 수정되면 정상적인 도메인 주소를 입력했음에도 함정 사이트로 향하도록 만들 수 있어 수정시 관리자 권한을 요구한다.

위와 같은 변조 공격 방식은 [[protocol/https]]을 통해서 페이지를 인증하는 방식으로도 방지할 수 있다.

## public DNS
공개적으로 제공하는 [[#DNS server]]를 의미한다. 세상에는 다양한 [[#DNS server]]가 존재하는데 처음 인터넷에 연결할 때 통신사가 설정해주는 [[#DNS server]] 외에도 구글 등에서 무료로 제공하는 [[#DNS server]]들이 존재한다. 이것이 [[#public DNS]]이다. 대표적으로 구글이 제공하는 `8.8.8.8`이 있다.

만약 속도나 프라이버시 등 모종의 사유로 자신이 이용하는 [[#DNS server]]를 바꾸고 싶다면 다른 [[#public DNS]]를 조사하고 네트워크 설정에서 [[#DNS server]] 부분을 수정하여 직접 바꿀 수도 있다. 

## name server
[[#DNS internal]]에서 기술하듯 [[#DNS server]]는 여러개가 계층적으로 구성되는데, 이 때 특정 도메인의 정보나 하위 [[#name server]]의 주소 등을 기록해두는 각각의 서버를 [[#name server]]라고 한다.

### record
[[#name server]]는 특정 도메인에 대한 정보나 하위 [[#name server]]의 정보를 담고 있는데, 이 때 담고 있는 각각의 정보 하나를 [[#record]]라고 부르며, 그것이 모여있는 파일을 [[#record file]]이라고 한다.

[[#record]]는 `$name $type $ip-address`로 구성되며, `$type`에 따라 다른 내용을 의미한다. 가령 `$type = NS`인 경우 가리키는 대상이 [[#name server]]임을 뜻하고, `$type = A` 인 경우 최종의 구체적인 도메인 주소임을 뜻한다. 자세한 것은 [[DNS record]] 참고

### record file


# DNS가 나오기 전
[[DNS]]가 나오기 전에는 [[#hosts file]]을 이용하여 [[domain name]]을 관리하였다. 다만 이렇게 하기 위해서는 사전에 연결하고자 하는 모든 컴퓨터에 해당 정보를 제공해야 했으며, 만약 모종의 사유로 [[ip 주소]]가 바뀌게 되면 그것을 새로이 배포해주어야만 했다.

이를 해결하기 위해 ==stanford research institute==라는 기관에서 [[#hosts file]]들을 관리하는 서비스를 제공하였다. 이를 통해 각종 서버 운영자들은 모든 클라이언트에 대응하여 정보를 뿌릴 필요 없이 ==SRI==에만 연락해 정보를 추가하거나 수정하면 되어 매우 편리해졌으며, 클라이언트들은 통신을 시작하기 전 ==SRI==의 [[#hosts file]]을 내려받아 덮어쓰는 방식으로 손쉽게 수많은 서버들에 대한 도메인 정보를 갱신할 수 있게 되었다.

다만 위 방법은 인터넷의 규모가 커짐에 따라서 문제가 발생하였는데 대표적으로 다음의 경우가 있다.

- ==SRI==에서 [[#hosts file]]을 내려받기 전까지는 갱신된 정보를 취할 수 없다.
- ==SRI==에서 [[#hosts file]]을 갱신하는 방식은 수작업으로, 요청되는 작업이 많아질수록 더 많은 인력과 비용이 요구되었다.
- ==SRI==에서 내려받는 [[#hosts file]]은 클라이언트가 원하는 서비스 뿐만이 아니라 관리되고 있는 모든 서비스에 대한 정보가 담겨 나왔기에 용량, 속도, 트래픽 등에서 큰 낭비를 야기했다.

사람들은 위와 같은 문제를 해결하기 위해 고민하였고, 그 결과 나온 것이 [[DNS]]이다.

# 원리
==서버==는 자신의 [[ip 주소]]와 그것에 대응해주었으면 하는 [[domain name]]을 [[#DNS server]]에 요청한다. [[#DNS server]]는 그 요청에 문제(*중복되는 도메인 주소가 있다던지*)가 없다면 해당 내용을 등록하여 도메인 정보를 보유하게 된다. (수정 및 삭제에도 대응한다.)

==클라이언트==는 처음 네트워크에 연결하는 순간 자동으로 특정 [[#DNS server]]의 [[ip 주소]]를 할당 받는다. 

==클라이언트==가 특정 [[domain name]]으로 접근하려고 한다면 우선 ==클라이언트== 내부의 [[#hosts file]]을 둘러본다. 여기 기록되어 있으면 해당 [[ip 주소]]로 연결하고, 만약 없다면 관련 정보를 [[#DNS server]]에 요청한다. [[#DNS server]]는 이 요청에 대해 대응하는 [[ip 주소]]가 있다면 그것을 반환해준다. ==클라이언트==는 이렇게 받은 [[ip 주소]]를 이용하여 목적지로 연결한다.

# DNS internal
[[#DNS server]]는 하나만 존재하지 않고 여러개가 각자의 역할을 수행하며 협력하여 [[DNS]]의 기능을 수행한다. 자세한 구조는 [[domain name#구조]] 참고

이 과정에서 상위 [[#DNS server]]에서부터 하위 [[#DNS server]]로 차례대로 깊어지며 DNS 주소를 탐색하는데, 이 과정에서 각 [[#DNS server]]는 자신이 해당 주소에 대한 정확한 정보를 가지고 있다면 바로 반환하고, 만약 그렇지 않다면 보다 하위의 더 자세한 정보를 가지고 있는 [[#DNS server]]의 주소를 반환한다. 그러면 클라이언트는 자신이 원하는 결과물을 얻을 때까지 이와 같은 과정을 반복하여 최종적으로 해당 주소에 대한 정확한 [[ip 주소]]를 얻어낼 수 있게 된다.

# DNS register
[[#DNS server]]에 

## ICANN
전 세계 모든 도메인 주소에 대한 ==root domain==을 관리하는 비영리단체. 모든 [[#DNS internal]]은 여기서 제공하는 [[#DNS server]]로부터 시작된다. 그러한 이유로 클라이언트는 물론 모든 [[#DNS server]]는 모두 여기서 제공하는 ==root domain [[#DNS server]]==를 알고 있다.

`a` 부터 `m` 까지의 이름을 가진 총 13개의 ==root domain [[#DNS server]]==가 존재하며 전세계 곳곳에 흩어져있다. 그것을 포함한 전체 주소는 `$a.root-servers.net` 이다.

## Registry
==등록소==

[[domain name]]을 등록하기 위한 장소로, 그와 동시에 ==top level [[#DNS server]]==를 운영한다. 예시로 `a.gtld-servers.net`이 있다.

## Registrar
==등록대행자==

사용자와 [[#Registry]] 중간에 껴서 이를 간소화하고 편의성을 제공하는 업체나 서비스.

[[#Registry]]는 ==top level [[#DNS server]]==을 운영하기 때문에 본래 자신의 [[domain name]]을 등록하기 위해서는 ==second level== 혹은 ==sub level== 까지의 ==등록용 name server==를 직접 구축하고 그 ==name server==를 등록하여야 한다. 

하지만 서비스 하나 등록하기 위해 ==name server==를 운영한다는 것은 매우 비효율적이기에 기존에 개설되어 있는 ==name server==를 이용하고자 하는데, 이 때 이를 제공해주어 편의성을 제공하는 것이 [[#Registrar]] 이다.

# Dynamic DNS
모바일 기기 등 [[ip 주소#Dynamic IP Address]]을 사용하는 경우 수시로 [[ip 주소]]가 변경되게 되는데 이 때 이에 맞춰 [[#DNS server]]에 해당 내용을 전달할 필요가 있다.

이를 자동으로 해주는 것이 [[#Dynamic DNS]]이다.

# domain 조회
## nslookup
`nslookup $domain-name` // [[domain name]]과 그것에 대응하는 [[ip 주소]]를 알기 위한 명령어. 최종 답안으로 `Non-authoritative answer`라는 제목으로 나오는 경우가 있는데, 이는 [[#DNS server]]가 효율 향상을 위해 기존에 질의했던 결과를 ==cache==에 저장해두었고, 요청했을 때 그 내용을 대답했음을 의미하는 것이다.  즉, ==권한이 없는 자의 대답==이라는 뜻. (*여기서 ==권한이 있는 자==는 해당 도메인 정보를 정확하게 기록하고 있는 [[#name server]]를 의미한다*)
	`nslookup -type=ns $domain-name$` // `type=ns`인 [[#record]]를 조회한다. 이를 통해 해당 정보가 저장된 [[#name server]]를 확인할 수 있다.
	`nslookup $domain-name $name-server` // `$domain-name`을 검색하되, `$name-server`에서 질의하도록 제한한다.

# domain mapping
서비스가 자리잡기 전에 타사가 제공하는 호스팅 서버 위에서 구동하는 경우 일반적으로 [[domain name]]도 복잡하고, 만약 본격적으로 서비스를 독립되게 구현하였을 때 기존 사용자들의 접근 루트가 끊기는 문제가 발생할 수 있다. 이를  하기 위해 관련 서비스들이 제공하는 서비스이다. 

기본적으로 다음의 절차를 걸쳐 설정한다.

1. 해당 서비스가 [[#domain mapping]]을 위해 제공하는 [[ip 주소]]를 확인하고 이를 이용하여 사용자 개인 목적의 [[domain name]]을 등록한다.
2. 해당 서비스의 설정에서 접근할 때 사용한 [[domain name]]이 사용자가 지정한 것인 경우, 사용자의 작업 결과물로 연결하도록 설정한다. (*==github==의 경우 `settting > github pages > custom domain` 부분에 개인적으로 사용하는 domain 을 지정하는 것으로 연결할 수 있다.*)

이러면 외부 접근자는 다음과 같은 순서로 호스팅 서비스 위에서 돌아가는 사용자 서버에 접근할 수 있게 된다.

1. ==외부 접근자==는 ==서비스 사용자==가 공개한 정보를 [[#DNS server]]에 조회하여 ==호스팅 서비스==의 접근루트 주소를 획득한다.
2. ==외부 접근자==는 받은 ==호스팅 서비스==의 접근 루트 주소로 접근하는데 이 때 ==서비스 사용자==가 등록했던 [[domain name]]의 주소로 접근하고 있다는 정보를 보유하고 접근한다.
3. ==호스팅 서비스==는 자신에게 접근할 때 사용한 [[domain name]]을 열람하고, 이에 대응하는 결과물로 연결을 넘겨준다.
4. 결과적으로 ==외부 접근자==는 ==호스팅 서비스==를 경유하여 ==서비스 사용자==가 제작한 결과물에 도달할 수 있게 된다.

# 참고
[[../../__reference/참고자료#DNS]]